# خطوات تطبيق الإصلاح في Railway

## الخطوة 1: تحديث قاعدة البيانات أولاً

### أ) من خلال Railway Dashboard:

1. افتح **Railway Dashboard**
2. اختر مشروعك
3. اضغط على **MySQL** service
4. اضغط على **Connect** أو **Query**
5. نفّذ هذا الكود SQL:

```sql
-- تحديث جميع القيم القديمة 'delivered' إلى 'delivered_completed'
UPDATE purchase_orders 
SET status = 'delivered_completed' 
WHERE status = 'delivered';

-- تحديث تعريف ENUM
ALTER TABLE purchase_orders 
MODIFY COLUMN status ENUM('approved', 'partially_delivered', 'delivered_completed') 
DEFAULT 'approved';
```

6. تأكد من نجاح التنفيذ (يجب أن تظهر رسالة نجاح)

### ب) أو باستخدام السكربت (إذا كان متاح):

في Railway CLI:
```bash
railway run node backend/update_po_status_enum.js
```

---

## الخطوة 2: رفع الكود المحدث إلى GitHub

1. **احفظ جميع التغييرات** في VS Code (Ctrl+S)

2. **افتح Terminal** في VS Code

3. **أضف الملفات للتحديث**:
```bash
git add .
```

4. **احفظ التغييرات**:
```bash
git commit -m "Fix: Update purchase_orders status ENUM to include delivered_completed"
```

5. **ارفع إلى GitHub**:
```bash
git push origin main
```
(أو `git push origin master` حسب اسم الفرع)

---

## الخطوة 3: الانتظار حتى يكتمل Deployment في Railway

1. Railway سيقوم تلقائياً بـ:
   - سحب التحديثات من GitHub
   - بناء المشروع
   - إعادة تشغيل الخادم

2. راقب **Deployments** في Railway Dashboard للتأكد من نجاح العملية

3. تأكد من عدم وجود أخطاء في **Logs**

---

## الخطوة 4: التحقق من الإصلاح

1. افتح التطبيق في المتصفح
2. جرب إنشاء/تحديث Purchase Order
3. تأكد من عدم ظهور خطأ `Data truncated for column 'status'`

---

## ملاحظات مهمة ⚠️

1. **يجب تحديث قاعدة البيانات أولاً** قبل رفع الكود
2. **انسخ البيانات** قبل أي تعديلات (backup)
3. إذا ظهر خطأ أثناء تحديث ENUM، تأكد من عدم وجود بيانات بقيمة `'delivered'`

---

## إذا واجهت مشكلة:

### المشكلة: "Data truncated" بعد التحديث
**الحل**: تأكد من تحديث قاعدة البيانات أولاً

### المشكلة: "Cannot connect to database"
**الحل**: تحقق من متغيرات البيئة في Railway

### المشكلة: الكود لم يتحدث
**الحل**: تأكد من رفع جميع الملفات إلى GitHub

